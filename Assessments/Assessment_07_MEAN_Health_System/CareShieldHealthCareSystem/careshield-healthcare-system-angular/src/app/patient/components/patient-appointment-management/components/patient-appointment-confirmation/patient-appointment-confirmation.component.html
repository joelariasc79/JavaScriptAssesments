<div class="min-h-screen bg-gray-50 flex items-start justify-center p-4 sm:p-8">
  <div class="max-w-4xl w-full bg-white rounded-xl shadow-2xl p-6 sm:p-10 transition-all duration-300">

    <h1 class="text-3xl font-extrabold text-indigo-700 mb-2">Confirm Your Appointment</h1>
    <p class="text-gray-600 mb-8 border-b pb-4">
      Please review the details below before finalizing your booking. You may add or edit notes for your doctor here.
    </p>

    <div *ngIf="loading() && !error() && !bookingMessage()" class="flex flex-col items-center justify-center p-12 text-indigo-600">
      <div class="animate-spin rounded-full h-10 w-10 border-4 border-t-indigo-500 border-gray-200 mb-4"></div>
      <p class="text-lg font-semibold">Loading details...</p>
    </div>

    <div *ngIf="error()" class="p-4 rounded-lg mb-6 bg-red-100 border-l-4 border-red-500 text-red-700 shadow-md transition-opacity duration-300" role="alert">
      <p class="font-bold">Booking Error:</p>
      <p>{{ error() }}</p>
    </div>

    <div *ngIf="bookingMessage()" class="p-4 rounded-lg mb-6 bg-green-100 border-l-4 border-green-500 text-green-700 shadow-md transition-opacity duration-300" role="status">
      <p class="font-bold">Success!</p>
      <p>{{ bookingMessage() }}</p>
    </div>

    <div *ngIf="!loading() && !error()">
      <div *ngIf="doctor() as d">
        <div *ngIf="bookingData() as b">
          <div *ngIf="screening() as s">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">

              <div class="bg-indigo-50 p-6 rounded-xl shadow-lg border border-indigo-200">
                <h2 class="text-xl font-bold text-indigo-700 mb-4 border-b border-indigo-300 pb-2">Appointment Details</h2>
                <dl class="space-y-3 text-sm">
                  <div class="flex justify-between items-center">
                    <dt class="font-medium text-gray-700">Doctor:</dt>
                    <dd class="text-indigo-600 font-semibold">Dr. {{ d.name }}</dd>
                  </div>
                  <div class="flex justify-between items-center">
                    <dt class="font-medium text-gray-700">Date:</dt>
                    <dd class="text-gray-900">{{ b.startTime | date: 'fullDate' }}</dd>
                  </div>
                  <div class="flex justify-between items-center">
                    <dt class="font-medium text-gray-700">Time:</dt>
                    <dd class="text-gray-900 font-mono">
                      {{ b.startTime | date: 'shortTime' }} - {{ b.endTime | date: 'shortTime' }}
                    </dd>
                  </div>
                  <div class="flex justify-between items-center">
                    <dt class="font-medium text-gray-700">Duration:</dt>
                    <dd class="text-gray-900">{{ b.durationMinutes }} minutes</dd>
                  </div>
                  <div class="pt-3 border-t border-indigo-200">
                    <dt class="font-medium text-gray-700">Reason for Visit (Chief Complaint):</dt>
                    <dd class="text-gray-900 italic mt-1 text-base">{{ b.reasonForVisit }}</dd>
                  </div>
                </dl>
              </div>

              <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b border-gray-200 pb-2">Screening Summary</h2>
                <dl class="space-y-3 text-sm">
                  <div class="flex justify-between items-center">
                    <dt class="font-medium text-gray-700">Symptom Duration:</dt>
                    <dd class="text-gray-900">{{ s.duration }}</dd>
                  </div>
                  <div class="flex justify-between items-center">
                    <dt class="font-medium text-gray-700">Pain Level:</dt>
                    <dd class="text-gray-900 font-semibold text-lg">{{ s.painLevel }} / 10</dd>
                  </div>
                  <div class="flex justify-between items-start pt-3 border-t mt-3 border-gray-200">
                    <dt class="font-medium text-gray-700">Current Medications:</dt>
                    <dd class="text-gray-900 text-right w-1/2">
                      <span *ngIf="s.currentMedications.length > 0; else noMeds">
                        {{ s.currentMedications.length }} medication(s) reported
                      </span>
                      <ng-template #noMeds><span class="italic text-sm">None Reported</span></ng-template>
                    </dd>
                  </div>
                </dl>
              </div>
            </div>

            <div class="p-6 bg-white rounded-xl shadow-md border border-gray-200 mb-8">
              <h3 class="text-lg font-bold text-gray-700 mb-3 flex items-center">
                Appointment Notes for the Doctor
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-indigo-500" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                </svg>
              </h3>
              <textarea
                rows="4"
                name="appointmentNotes"
                [(ngModel)]="appointmentNotes"
                placeholder="Type any additional information or questions you have for your doctor (optional)..."
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-sm text-sm"
              ></textarea>
              <p class="mt-2 text-xs text-gray-500">The notes above will be finalized and sent to your doctor with the booking.</p>
            </div>

            <div class="flex justify-between pt-4">
              <button type="button" (click)="onCancel()"
                      class="px-6 py-3 border border-gray-300 text-base font-medium rounded-lg shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                Change Details
              </button>

              <button type="button" (click)="bookAppointment()"
                      [disabled]="loading() || error() !== null || bookingMessage() !== null"
                      class="px-8 py-3 border border-transparent text-base font-medium rounded-lg shadow-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150 ease-in-out">
                <span *ngIf="!loading()">Final Confirm Booking</span>
                <span *ngIf="loading()" class="flex items-center">
                  <div class="animate-spin rounded-full h-4 w-4 border-2 border-t-white border-green-300 mr-2"></div>
                  Booking...
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
