<div class="min-h-screen bg-gray-100 p-8 font-sans">
  <h1 class="text-4xl font-extrabold text-center text-gray-900 mb-2">
    Hospital Admin Dashboard
  </h1>
  <p class="text-center text-gray-600 mb-8">
    Client application to manage hospital data.
  </p>

  <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">{{ isUpdateMode() ? 'Update Hospital' : 'Create New Hospital' }}</h2>
      <form (ngSubmit)="submitHospital()">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <div class="flex flex-col">
            <label for="name" class="text-sm font-medium text-gray-700 mb-1">Name <span class="text-red-500">*</span></label>
            <input id="name" type="text" [ngModel]="newHospital().name" (ngModelChange)="updateField('name', $event)" name="name"
                   class="input-field" placeholder="e.g., General Hospital" required />
            <span *ngIf="formSubmitted() && !isNameValid()" class="text-red-500 text-xs mt-1">Hospital name is required.</span>
          </div>
          <div class="flex flex-col">
            <label for="type" class="text-sm font-medium text-gray-700 mb-1">Type <span class="text-red-500">*</span></label>
            <select id="type" [ngModel]="newHospital().type" (ngModelChange)="updateField('type', $event)" name="type"
                    class="input-field" required>
              <option [ngValue]="" disabled>Select a type</option>
              <option *ngFor="let type of hospitalTypes" [value]="type">{{ type }}</option>
            </select>
            <span *ngIf="formSubmitted() && !isTypeValid()" class="text-red-500 text-xs mt-1">Hospital type is required.</span>
          </div>
          <div class="flex flex-col">
            <label for="street" class="text-sm font-medium text-gray-700 mb-1">Street <span class="text-red-500">*</span></label>
            <input id="street" type="text" [ngModel]="newHospital().address.street" (ngModelChange)="updateAddressField('street', $event)" name="street"
                   class="input-field" placeholder="e.g., 123 Main St" required />
            <span *ngIf="formSubmitted() && !isStreetValid()" class="text-red-500 text-xs mt-1">Street is required.</span>
          </div>
          <div class="flex flex-col">
            <label for="city" class="text-sm font-medium text-gray-700 mb-1">City <span class="text-red-500">*</span></label>
            <input id="city" type="text" [ngModel]="newHospital().address.city" (ngModelChange)="updateAddressField('city', $event)" name="city"
                   class="input-field" placeholder="e.g., Anytown" required />
            <span *ngIf="formSubmitted() && !isCityValid()" class="text-red-500 text-xs mt-1">City is required.</span>
          </div>
          <div class="flex flex-col">
            <label for="state" class="text-sm font-medium text-gray-700 mb-1">State <span class="text-red-500">*</span></label>
            <select id="state" [ngModel]="newHospital().address.state" (ngModelChange)="updateAddressField('state', $event)" name="state"
                    class="input-field" required>
              <option value="" disabled selected>Select a state</option>
              <option *ngFor="let state of usStates" [value]="state">{{ state }}</option>
            </select>
            <span *ngIf="formSubmitted() && !isStateValid()" class="text-red-500 text-xs mt-1">State is required.</span>
          </div>
          <div class="flex flex-col">
            <label for="contact_number" class="text-sm font-medium text-gray-700 mb-1">Contact Number <span class="text-red-500">*</span></label>
            <input id="contact_number" type="tel" [ngModel]="newHospital().contact_number" (ngModelChange)="updateField('contact_number', $event)" name="contact_number"
                   class="input-field" placeholder="e.g., 123-456-7890" required pattern="^\d{3}-\d{3}-\d{4}$"
                   [appMaskedInput]="'###-###-####'" />
            <span *ngIf="newHospital().contact_number && !isPhoneValid()" class="text-red-500 text-xs mt-1">Please enter a valid phone number (e.g., 123-456-7890).</span>
          </div>
          <div class="flex flex-col">
            <label for="charges" class="text-sm font-medium text-gray-700 mb-1">Charges <span class="text-red-500">*</span></label>
            <input id="charges" type="number" [ngModel]="newHospital().charges" (ngModelChange)="updateField('charges', $event)" name="charges"
                   class="input-field" placeholder="e.g., 1500" required min="1" />
            <span *ngIf="newHospital().charges !== 0 && !areChargesValid()" class="text-red-500 text-xs mt-1">Charges must be greater than 0.</span>
          </div>
        </div>

        <button type="submit" [disabled]="!isFormValid() || loading()"
                class="mt-8 w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          {{ loading() ? 'Processing...' : (isUpdateMode() ? 'Update Hospital' : 'Create Hospital') }}
        </button>
        <button *ngIf="isUpdateMode()" type="button" (click)="cancelUpdate()"
                class="mt-4 w-full px-6 py-3 bg-gray-400 text-white font-semibold rounded-lg shadow-md hover:bg-gray-500 transition-colors">
          Cancel Update
        </button>
        <p *ngIf="message()" class="mt-4 text-center"
           [class.text-green-600]="!error()" [class.text-red-600]="error()">
          {{ message() }}
        </p>
      </form>
    </div>

    <!--Hospitals List-->
    <div class="bg-white p-1 rounded-xl shadow-lg border border-gray-200">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Existing Hospitals</h2>
      <div *ngIf="loading()" class="text-center text-gray-500">
        <p>Loading hospitals...</p>
      </div>
      <div *ngIf="hospitals().length > 0 && !loading()" class="overflow-x-auto">
        <table class="w-full table-auto">
          <thead>
          <tr class="bg-gray-200 text-gray-700 uppercase text-sm leading-normal">
            <th class="py-3 px-6 text-left">Name</th>
            <th class="py-3 px-6 text-left hidden sm:table-cell">Type</th>
            <th class="py-3 px-6 text-left hidden sm:table-cell">Contact</th>
            <th class="py-3 px-6 text-center">Actions</th>
          </tr>
          </thead>
          <tbody class="text-gray-600 text-sm font-light">
          <tr *ngFor="let hospital of hospitals()" class="border-b border-gray-200 hover:bg-gray-100">
            <td class="py-3 px-4 text-left whitespace-nowrap">
              <div class="flex items-center">
                <div class="mr-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2h2V1a1 1 0 112 0v2h2a2 2 0 012 2v15a1 1 0 01-1 1H5a1 1 0 01-1-1V5zm3 2a1 1 0 000 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
                  </svg>
                </div>
                <span class="font-medium">{{ hospital.name }}</span>
              </div>
            </td>
            <td class="py-3 px-6 text-left hidden sm:table-cell">{{ hospital.type }}</td>
            <td class="py-3 px-6 text-left hidden sm:table-cell">{{ hospital.contact_number }}</td>
            <td class="py-3 px-6 text-center">
              <div class="flex item-center justify-center space-x-2">
                <button (click)="onUpdateClick(hospital)" class="transform hover:scale-110">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <button (click)="onDeleteClick(hospital._id!)" class="transform hover:scale-110">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="hospitals().length === 0 && !loading()" class="text-center text-gray-500">
        <p>No hospitals found. Add a new one to get started!</p>
      </div>
    </div>
  </div>
</div>
